{
  "Name": "QuadScatter",
  "_id": "b06dae77-ddb1-44d3-80d4-56e7ce7b6fcc",
  "Namespace": "lib.geometry.modify",
  "Description": "GPU-based scatter deform derived from StreamOutput.",
  "Inputs": [
    {
      "Name": "Code",
      "MetaInstanceID": "018a9bce-bdfb-45dd-84b1-0cdf5b59d956",
      "DefaultValue": {
        "Type": "Text",
        "Value": [
          "//>>> _parameters\r",
          "float3 Center;",
          "float2 Range;",
          "float Push;",
          "float Shrink;",
          "float3 Translate;",
          "float3 Scale;",
          "float3 ScaleRandom;",
          "Texture2D NoiseTexture;",
          "float NoiseScale;",
          "float3 Scatter;",
          "float3 Spin;",
          "float3 SpinRandom;",
          "//<<< _parameters\r",
          "\r",
          "\r",
          "struct Vertex\r",
          "{\r",
          "    float4 pos : POSITION;\r",
          "    float3 normal : NORMAL;\r",
          "    float4 col : COLOR;\r",
          "    float2 texCoord : TEXCOORD0;\r",
          "    float3 tangent : TANGENT0;\r",
          "    float3 binormal : BINORMAL0;\r",
          "};\r",
          "\r",
          "\r",
          "/*\r",
          "float getNoise(int x, int seed)\r",
          "{\r",
          "    int n = x + seed*137;\r",
          "    n = (n << 13) ^ n;\r",
          "    return (float) (1.0 - ((n*(n*n*15731 + 789221) + 1376312589) & 0x7fffffff)/1073741824.0);\r",
          "}\r",
          "\r",
          "*/\r",
          "\r",
          "\r",
          "\r",
          "Vertex VertexMain(Vertex input)\r",
          "{\r",
          "    return input;\r",
          "}\r",
          "\r",
          "SamplerState samLinear\r",
          "{\r",
          "    Filter = MIN_MAG_MIP_LINEAR;\r",
          "    AddressU = Wrap;\r",
          "    AddressV = Wrap;\r",
          "};\r",
          "\r",
          "\r",
          "[maxvertexcount(3)]\r",
          "void GeometryMain(triangle Vertex input[3], inout TriangleStream<Vertex> outputStream, uint id : SV_PrimitiveID)\r",
          "{\r",
          "    int seed = id & 0xFFFFFE;\r",
          "     \r",
          "    float3 p1 = input[0].pos;\r",
          "    float3 p2 = input[1].pos;\r",
          "    float3 p3 = input[2].pos;\r",
          "    \r",
          "       \r",
          "    // Find Quad-Center by checking inner angle close to 90    \r",
          "    float a1 = dot( p2- p1 , p1 - p3 ); // p23\r",
          "    float a2 = dot( p1- p2 , p2 - p3);  // p13\r",
          "    float a3 = dot( p1- p3 , p3 - p2);  // p12\r",
          "\r",
          "    float3 pCenter;\r",
          "    \r",
          "    if( a1 > a2 && a1 > a3) {\r",
          "        pCenter = (p2 + p3) / 2;\r",
          "    }\r",
          "    else if( a2 > a3) {\r",
          "        pCenter = (p1 + p3) / 2;\r",
          "    }\r",
          "    else {\r",
          "        pCenter = (p1 + p2) / 2;\r",
          "    }\r",
          "    \r",
          "    \r",
          "    \r",
          "    float4 noiseColor1 = NoiseTexture.SampleLevel(samLinear, (pCenter.xy + pCenter.zy) / NoiseScale, 0);\r",
          "    float4 noiseColor2 = NoiseTexture.SampleLevel(samLinear, (pCenter.yz + pCenter.yx) / NoiseScale, 0);\r",
          "\r",
          "    float3 direction = (pCenter-Center);\r",
          "    float distance = length(direction);            \r",
          "    float falloff = Range.y;\r",
          "    if (falloff == 0) {\r",
          "        falloff = 0.00001;\r",
          "    }\r",
          "    float x = clamp(- (distance - Range.x)/falloff, 0, 1);\r",
          "    \r",
          "    float influence = x*x*(3 - 2*x);  // SmoothStep\r",
          "\r",
          "\r",
          "    float3 angleXYZ= influence * ( Spin * 3.1415 / 180  + ( SpinRandom * 3.1415 / 180 * (noiseColor2.rgb - 0.5)));\r",
          "    float cax= cos(angleXYZ.x);\r",
          "    float sax= sin(angleXYZ.x);    \r",
          "    float4x4 rotx = {    1,    0,    0,    0,\r",
          "                         0,    cax, -sax,  0,\r",
          "                         0,    sax,  cax,  0,\r",
          "                         0,    0,    0,    1};\r",
          "                         \r",
          "    float cay= cos(angleXYZ.y);\r",
          "    float say= sin(angleXYZ.y);    \r",
          "    float4x4 roty = {    cay,  0,    say,  0,\r",
          "                         0,    1,    0,    0,\r",
          "                        -say,  0,    cay,  0,\r",
          "                         0,    0,    0,    1};\r",
          "                         \r",
          "    float caz= cos(angleXYZ.z);\r",
          "    float saz= sin(angleXYZ.z);    \r",
          "    float4x4 rotz = {    caz, -saz,   0,    0,\r",
          "                         saz,  caz,   0,    0,\r",
          "                         0,    0,     1,    0,\r",
          "                         0,    0,     0,    1};\r",
          "\r",
          "\r",
          "    float4x4 translateToOrigin ={ 1,    0,    0,   -pCenter.x,\r",
          "                             0,    1,    0,   -pCenter.y,\r",
          "                             0,    0,    1,   -pCenter.z,\r",
          "                             0,    0,    0,   1};\r",
          "\r",
          "    float4x4 translateBack={  1,    0,    0,   pCenter.x,\r",
          "                             0,    1,    0,    pCenter.y,\r",
          "                             0,    0,    1,    pCenter.z,\r",
          "                             0,    0,    0,   1};\r",
          "\r",
          "    float shrinkScale = 1-clamp(influence * Shrink, 0,1);\r",
          "    float3 scaleFactor =  lerp(float3(1,1,1),   Scale + noiseColor1.rgb * ScaleRandom,  influence ) * shrinkScale;\r",
          "    //scaleFactor= float3(1,1,1);\r",
          "    float4x4 scaleT={        scaleFactor.x,    0,    0,   0,\r",
          "                             0,    scaleFactor.y,    0,   0,\r",
          "                             0,    0,    scaleFactor.z,   0,\r",
          "                             0,    0,    0,   1};\r",
          "\r",
          "\r",
          "    float3 offset=  normalize(direction) * influence * ( Push + (noiseColor2.xyz - float3(0.5, 0.5, 0.5))* Scatter + Translate);\r",
          "    \r",
          "    \r",
          "    float4x4 translateOffset={ 1,    0,    0,   offset.x,\r",
          "                               0,    1,    0,   offset.y,\r",
          "                               0,    0,    1,   offset.z, \r",
          "                               0,    0,    0,   1};\r",
          "\r",
          "    float4x4 spin = mul(roty,rotx);\r",
          "    spin = mul(spin, rotz);\r",
          "    \r",
          "    float4x4 transform= {1,0,0,0,  0,1,0,0,  0,0,1,0,  0,0,0,1};\r",
          "    \r",
          "    //float4x4 transform = spin;        \r",
          "    //float4x4 transform = translateToOrigin;\r",
          "    transform = mul( translateToOrigin, transform);\r",
          "    transform = mul( scaleT, transform);\r",
          "    transform = mul( spin, transform);\r",
          "    transform = mul( translateOffset, transform);\r",
          "    \r",
          "    transform = mul( translateBack, transform);\r",
          "    \r",
          "    //transform = mul( translateToOrigin, transform);\r",
          "   \r",
          "    \r",
          "    \r",
          "    //shrinkScale = 1;\r",
          "\r",
          "\r",
          "    for (int i = 0; i < 3; i++)\r",
          "\t{\r",
          "\t/*\r",
          "        Vertex vertex = input[i];\r",
          "        float4 p = vertex.pos;\r",
          "        \r",
          "        p.xyz+= Translate;\r",
          "        \r",
          "        p.xyz+= (pCenter - p) * (scaleFactor);        \r",
          "        p.xyz+= (pCenter - p) * (shrinkScale);\r",
          "        \r",
          "    \r",
          "        p.xyz+= direction/distance * influence * Push; \r",
          "        p = mul(transform, p);    \r",
          "        \r",
          "        vertex.pos.xyz = p.xyz;\r",
          "        vertex.normal = mul( float4(vertex.normal.xyz,1), spin);\r",
          "        */\r",
          "        \r",
          "        Vertex vertex = input[i];\r",
          "        vertex.pos = mul(transform, vertex.pos);\r",
          "        vertex.normal = normalize( mul(transform,  float4(vertex.normal.xyz,1)));\r",
          "        outputStream.Append(vertex);\r",
          "    }\r",
          "    outputStream.RestartStrip();\r",
          "};\r",
          "\r",
          "\r",
          "GeometryShader pGSComp = CompileShader(gs_5_0, GeometryMain());\r",
          "GeometryShader pGSwSO = ConstructGSWithSO(pGSComp, \"POSITION; NORMAL.xyz; COLOR; TEXCOORD0.xy; TANGENT0.xyz; BINORMAL0.xyz\", NULL, NULL, NULL, 0);\r",
          "\r",
          "\r",
          "technique11 Render\r",
          "{\r",
          "    pass \r",
          "    {\r",
          "        SetVertexShader(CompileShader(vs_5_0, VertexMain()));\r",
          "        SetGeometryShader(pGSwSO);\r",
          "        SetPixelShader(NULL);\r",
          "    }\r",
          "}\r",
          "\r",
          ""
        ]
      },
      "MetaID": "c522a66e-3260-4692-b3e3-79fd0361fa3d",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Scene",
      "MetaInstanceID": "344911b6-bc6e-4be0-9f26-2d59a0927ca9",
      "DefaultValue": {
        "Type": "Scene",
        "Value": "Framefield.Core.Scene"
      },
      "MetaID": "79122951-7bc4-4c68-b085-866eab828248",
      "IsMultiInput": "False",
      "Relevance": "Required",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Center.X",
      "MetaInstanceID": "80c445c6-cef0-4137-9ed1-f6506ccb90aa",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Center.Y",
      "MetaInstanceID": "5f6a5688-e690-4ce8-ace2-b3c3d7dc2d14",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Center.Z",
      "MetaInstanceID": "243ff53d-26f7-46f5-831d-4c881879e1f9",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Range.Size",
      "MetaInstanceID": "668eec30-9f7a-40f5-9e44-dd8b18f3c8d4",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Range.FallOff",
      "MetaInstanceID": "e667e511-58ad-44a8-9869-0728f0acf8ca",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Push",
      "MetaInstanceID": "8744e8c3-11c9-4c6c-9022-7395825b49fe",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Shrink",
      "MetaInstanceID": "64aec963-728d-4870-b628-c9bac49d7748",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Translate.X",
      "MetaInstanceID": "3f674a04-27e0-45ae-855f-b5862adc6ff7",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Translate.Y",
      "MetaInstanceID": "d4f46390-9927-44f2-8741-4fe0ff80fdb6",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Translate.Z",
      "MetaInstanceID": "3f24ba34-93f5-40b5-b78b-d6eb0a4eedc6",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Scale.X",
      "MetaInstanceID": "4c398ff5-198f-47e1-8e13-cb70bee9ea8d",
      "DefaultValue": {
        "Type": "Float",
        "Value": "1"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Scale.Y",
      "MetaInstanceID": "195bcb59-8186-4719-950b-7f043b05bcdd",
      "DefaultValue": {
        "Type": "Float",
        "Value": "1"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Scale.Z",
      "MetaInstanceID": "ed95fba4-817d-4e96-8bc5-901c86a41093",
      "DefaultValue": {
        "Type": "Float",
        "Value": "1"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "ScaleRandom.X",
      "MetaInstanceID": "f1ee8f88-3efa-49f0-ad0d-55f63da6707e",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "0",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "ScaleRandom.Y",
      "MetaInstanceID": "6ee62345-91af-4b4b-8e1c-bef6800fbd90",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "0",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "ScaleRandom.Z",
      "MetaInstanceID": "08dd1c46-cd70-4008-917a-0142dfef755e",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "0",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "NoiseTexture",
      "MetaInstanceID": "80bfeb0d-947a-4c49-badb-82819d275938",
      "DefaultValue": {
        "Type": "Image",
        "Value": "Framefield.Core.Image"
      },
      "MetaID": "9848060d-fd84-45b0-b658-d0d531c61dab",
      "IsMultiInput": "False",
      "Relevance": "Required",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "NoiseScale",
      "MetaInstanceID": "205bce44-d156-4ddc-8568-86e16bb3335a",
      "DefaultValue": {
        "Type": "Float",
        "Value": "1"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Scatter.X",
      "MetaInstanceID": "25a97dfc-84f6-4153-a236-564465e08e3e",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Scatter.Y",
      "MetaInstanceID": "d3c74e78-a833-4b69-afa2-a1746fafa5bf",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Scatter.Z",
      "MetaInstanceID": "6ebadd16-2b44-4b4e-a3e4-dbe0392b6865",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Spin.X",
      "MetaInstanceID": "165fdf60-7bd9-4aab-b893-9d91ec339a55",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Spin.Y",
      "MetaInstanceID": "bd259b64-8a03-46ed-a5a0-319329eaab2e",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Spin.Z",
      "MetaInstanceID": "45849335-c44c-4cf3-b114-64ca4f775015",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "SpinRandom.X",
      "MetaInstanceID": "121f3634-b246-4a1d-8d6a-70411763d90c",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "SpinRandom.Y",
      "MetaInstanceID": "4bffc4d9-ab7f-4e54-ad8b-bbbead604dfc",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "SpinRandom.Z",
      "MetaInstanceID": "2b35b23e-79fb-49d9-8d9c-4ea6c7efc968",
      "DefaultValue": {
        "Type": "Float",
        "Value": "0"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-10000",
      "Max": "10000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    }
  ],
  "Outputs": [
    {
      "Name": "Scene",
      "MetaInstanceID": "1d274b03-a69a-4c9f-ac43-2a89b657651a",
      "MetaID": "79122951-7bc4-4c68-b085-866eab828248"
    }
  ],
  "OperatorParts": [
    {
      "MetaInstanceID": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d",
      "MetaID": "9722c7bc-d8d9-4c55-ba68-ee6bfb021cb0",
      "Name": "QuadScatterFunc",
      "Version": "aae6d22d-d2fa-4e18-9fcc-134ce599ec8a",
      "Type": "Float",
      "IsMultiInput": "True",
      "Script": [
        "//>>> _using",
        "using System;",
        "using System.Collections.Generic;",
        "using System.Linq;",
        "using System.Text;",
        "using SharpDX;",
        "using SharpDX.Direct3D11;",
        "using SharpDX.Windows;",
        "//<<< _using",
        "using Framefield.Core.OperatorPartTraits;",
        "using Framefield.Core.Rendering;",
        "using Buffer = SharpDX.Direct3D11.Buffer;",
        "using SharpDX.Direct3D;",
        "",
        "namespace Framefield.Core.ID9722c7bc_d8d9_4c55_ba68_ee6bfb021cb0",
        "{",
        "    public class Class_QuadScatter : FXSourceCodeFunction, IFXSceneSourceCode, IMeshSupplier",
        "    {",
        "        //>>> _inputids",
        "        private enum InputId",
        "        {",
        "            Code = 0,",
        "            Scene = 1,",
        "            CenterX = 2,",
        "            CenterY = 3,",
        "            CenterZ = 4,",
        "            RangeSize = 5,",
        "            RangeFallOff = 6,",
        "            Push = 7,",
        "            Shrink = 8,",
        "            TranslateX = 9,",
        "            TranslateY = 10,",
        "            TranslateZ = 11,",
        "            ScaleX = 12,",
        "            ScaleY = 13,",
        "            ScaleZ = 14,",
        "            ScaleRandomX = 15,",
        "            ScaleRandomY = 16,",
        "            ScaleRandomZ = 17,",
        "            NoiseTexture = 18,",
        "            NoiseScale = 19,",
        "            ScatterX = 20,",
        "            ScatterY = 21,",
        "            ScatterZ = 22,",
        "            SpinX = 23,",
        "            SpinY = 24,",
        "            SpinZ = 25,",
        "            SpinRandomX = 26,",
        "            SpinRandomY = 27,",
        "            SpinRandomZ = 28",
        "        }",
        "        //<<< _inputids",
        "",
        "        public Class_QuadScatter()",
        "        {",
        "            _meshCollector = new MeshCollector(this);",
        "        }",
        "",
        "        public override void Dispose() ",
        "        {",
        "            Utilities.DisposeObj(ref _mesh);",
        "            base.Dispose();",
        "        }",
        "",
        "        public void AddMeshesTo(ICollection<Mesh> meshes)",
        "        {",
        "            UpdateMesh(new OperatorPartContext(), OperatorPart.Connections);",
        "            if (_mesh != null)",
        "                meshes.Add(_mesh);",
        "        }",
        "",
        "        public override OperatorPartContext Eval(OperatorPartContext context, List<OperatorPart> inputs, int outputIdx)",
        "        {",
        "            try",
        "            {",
        "                UpdateMesh(context, inputs);",
        "",
        "                if (_mesh.Vertices != null)",
        "                {",
        "                    // render stream output to screen or whatever target is set",
        "                    context.Renderer.SetupEffect(context);",
        "                    context.Renderer.Render(_mesh, context);",
        "                }",
        "            }",
        "            catch (Exception exception)",
        "            {",
        "                Logger.Error(this, \"Load Effect error: {0}\", exception.Message);",
        "            }",
        "",
        "            return context;",
        "        }",
        "",
        "        bool _firstEval = true;",
        "        private void UpdateMesh(OperatorPartContext context, List<OperatorPart> inputs)",
        "        {",
        "            if (_firstEval)",
        "            {",
        "                for (int i = 0; i < NumCodes(); ++i)",
        "                    Compile(i);",
        "                _firstEval = false;",
        "                Changed = true;",
        "            }",
        "",
        "            if (!Changed && _mesh.Vertices != null)",
        "                return;",
        "",
        "            //>>> _params",
        "            var Code = inputs[(int)InputId.Code].Eval(context).Text;",
        "            var Scene = inputs[(int)InputId.Scene];",
        "            var CenterX = inputs[(int)InputId.CenterX].Eval(context).Value;",
        "            var CenterY = inputs[(int)InputId.CenterY].Eval(context).Value;",
        "            var CenterZ = inputs[(int)InputId.CenterZ].Eval(context).Value;",
        "            var Center = new Vector3(CenterX, CenterY, CenterZ);",
        "            var RangeSize = inputs[(int)InputId.RangeSize].Eval(context).Value;",
        "            var RangeFallOff = inputs[(int)InputId.RangeFallOff].Eval(context).Value;",
        "            var Range = new Vector2(RangeSize, RangeFallOff);",
        "            var Push = inputs[(int)InputId.Push].Eval(context).Value;",
        "            var Shrink = inputs[(int)InputId.Shrink].Eval(context).Value;",
        "            var TranslateX = inputs[(int)InputId.TranslateX].Eval(context).Value;",
        "            var TranslateY = inputs[(int)InputId.TranslateY].Eval(context).Value;",
        "            var TranslateZ = inputs[(int)InputId.TranslateZ].Eval(context).Value;",
        "            var Translate = new Vector3(TranslateX, TranslateY, TranslateZ);",
        "            var ScaleX = inputs[(int)InputId.ScaleX].Eval(context).Value;",
        "            var ScaleY = inputs[(int)InputId.ScaleY].Eval(context).Value;",
        "            var ScaleZ = inputs[(int)InputId.ScaleZ].Eval(context).Value;",
        "            var Scale = new Vector3(ScaleX, ScaleY, ScaleZ);",
        "            var ScaleRandomX = inputs[(int)InputId.ScaleRandomX].Eval(context).Value;",
        "            var ScaleRandomY = inputs[(int)InputId.ScaleRandomY].Eval(context).Value;",
        "            var ScaleRandomZ = inputs[(int)InputId.ScaleRandomZ].Eval(context).Value;",
        "            var ScaleRandom = new Vector3(ScaleRandomX, ScaleRandomY, ScaleRandomZ);",
        "            var NoiseTexture = inputs[(int)InputId.NoiseTexture].Eval(context).Image; // Needs to be checked for null!",
        "            var NoiseScale = inputs[(int)InputId.NoiseScale].Eval(context).Value;",
        "            var ScatterX = inputs[(int)InputId.ScatterX].Eval(context).Value;",
        "            var ScatterY = inputs[(int)InputId.ScatterY].Eval(context).Value;",
        "            var ScatterZ = inputs[(int)InputId.ScatterZ].Eval(context).Value;",
        "            var Scatter = new Vector3(ScatterX, ScatterY, ScatterZ);",
        "            var SpinX = inputs[(int)InputId.SpinX].Eval(context).Value;",
        "            var SpinY = inputs[(int)InputId.SpinY].Eval(context).Value;",
        "            var SpinZ = inputs[(int)InputId.SpinZ].Eval(context).Value;",
        "            var Spin = new Vector3(SpinX, SpinY, SpinZ);",
        "            var SpinRandomX = inputs[(int)InputId.SpinRandomX].Eval(context).Value;",
        "            var SpinRandomY = inputs[(int)InputId.SpinRandomY].Eval(context).Value;",
        "            var SpinRandomZ = inputs[(int)InputId.SpinRandomZ].Eval(context).Value;",
        "            var SpinRandom = new Vector3(SpinRandomX, SpinRandomY, SpinRandomZ);",
        "            //<<< _params",
        "",
        "            if (Scene.Func.Changed || _mesh.Vertices == null)",
        "            {",
        "                //Logger.Info(this, \"collect meshes\");",
        "                _meshCollector.Collect(Scene);",
        "                Scene.Func.Changed = false;",
        "            }",
        "",
        "            var inputMesh = _meshCollector.FirstMeshOrDefault;",
        "            if (inputMesh == null)",
        "                return;",
        "                ",
        "            if(NoiseTexture == null)",
        "                return;",
        "",
        "            _mesh.AttributesSize = inputMesh.AttributesSize;",
        "            _mesh.NumTriangles = inputMesh.NumTriangles;",
        "            _mesh.InputElements = inputMesh.InputElements;",
        "            if (_mesh.Vertices == null || _mesh.Vertices.Description.SizeInBytes != inputMesh.Vertices.Description.SizeInBytes)",
        "            {",
        "                if (_mesh.Vertices != null)",
        "                    _mesh.Vertices.Dispose();",
        "",
        "                _mesh.Vertices = new Buffer(D3DDevice.Device, new BufferDescription()",
        "                                                                    {",
        "                                                                        BindFlags = BindFlags.StreamOutput | BindFlags.VertexBuffer,",
        "                                                                        CpuAccessFlags = CpuAccessFlags.None,",
        "                                                                        OptionFlags = ResourceOptionFlags.None,",
        "                                                                        SizeInBytes = _mesh.NumTriangles*inputMesh.AttributesSize*3,",
        "                                                                        Usage = ResourceUsage.Default",
        "                                                                    });",
        "            }",
        "",
        "            _effect.GetVariableByName(\"Center\").AsVector().Set(new Vector3(CenterX, CenterY, CenterZ));",
        "            _effect.GetVariableByName(\"Translate\").AsVector().Set(new Vector3(TranslateX, TranslateY, TranslateZ));",
        "            _effect.GetVariableByName(\"Range\").AsVector().Set(new Vector2(RangeSize, RangeFallOff));",
        "            _effect.GetVariableByName(\"Push\").AsScalar().Set(Push);",
        "            _effect.GetVariableByName(\"Shrink\").AsScalar().Set(Shrink);",
        "            _effect.GetVariableByName(\"Scatter\").AsVector().Set(Scatter);",
        "            ",
        "            _effect.GetVariableByName(\"NoiseScale\").AsScalar().Set(NoiseScale);",
        "            _effect.GetVariableByName(\"Scale\").AsVector().Set(Scale);",
        "            _effect.GetVariableByName(\"ScaleRandom\").AsVector().Set(ScaleRandom);",
        "            ",
        "            _effect.GetVariableByName(\"Spin\").AsVector().Set(Spin);",
        "            _effect.GetVariableByName(\"SpinRandom\").AsVector().Set(SpinRandom);",
        "            ",
        "            var noiseTextureView = new ShaderResourceView(context.D3DDevice, NoiseTexture);            ",
        "            _effect.GetVariableByName(\"NoiseTexture\").AsShaderResource().SetResource(noiseTextureView);",
        "            ",
        "            ",
        "",
        "            context.D3DDevice.ImmediateContext.StreamOutput.SetTargets(new [] { new StreamOutputBufferBinding(_mesh.Vertices, 0) } );",
        "            context.D3DDevice.ImmediateContext.OutputMerger.DepthStencilState = new DepthStencilState(context.D3DDevice,",
        "                                                                                                        new DepthStencilStateDescription()",
        "                                                                                                            {",
        "                                                                                                                IsDepthEnabled = false,",
        "                                                                                                                IsStencilEnabled = false",
        "                                                                                                            });",
        "            context.D3DDevice.ImmediateContext.InputAssembler.InputLayout = context.InputLayout;",
        "            context.D3DDevice.ImmediateContext.InputAssembler.PrimitiveTopology = PrimitiveTopology.TriangleList;",
        "            context.D3DDevice.ImmediateContext.InputAssembler.SetVertexBuffers(0, new VertexBufferBinding(inputMesh.Vertices, inputMesh.AttributesSize, 0));",
        "            var technique = _effect.GetTechniqueByIndex(0);",
        "            technique.GetPassByIndex(0).Apply(context.D3DDevice.ImmediateContext);",
        "            context.D3DDevice.ImmediateContext.Draw(_mesh.NumTriangles*3, 0);",
        "            context.D3DDevice.ImmediateContext.StreamOutput.SetTargets(new [] { new StreamOutputBufferBinding(null, 0) });",
        "",
        "            Changed = false;",
        "        }",
        "",
        "        private Mesh _mesh = new Mesh();",
        "        private MeshCollector _meshCollector;",
        "    }",
        "}",
        "",
        "",
        ""
      ],
      "AdditionalAssemblies": []
    }
  ],
  "Operators": [],
  "Connections": [
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "1d274b03-a69a-4c9f-ac43-2a89b657651a"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "018a9bce-bdfb-45dd-84b1-0cdf5b59d956",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "344911b6-bc6e-4be0-9f26-2d59a0927ca9",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "80c445c6-cef0-4137-9ed1-f6506ccb90aa",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "5f6a5688-e690-4ce8-ace2-b3c3d7dc2d14",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "243ff53d-26f7-46f5-831d-4c881879e1f9",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "668eec30-9f7a-40f5-9e44-dd8b18f3c8d4",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "e667e511-58ad-44a8-9869-0728f0acf8ca",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "8744e8c3-11c9-4c6c-9022-7395825b49fe",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "64aec963-728d-4870-b628-c9bac49d7748",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "3f674a04-27e0-45ae-855f-b5862adc6ff7",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "d4f46390-9927-44f2-8741-4fe0ff80fdb6",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "3f24ba34-93f5-40b5-b78b-d6eb0a4eedc6",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "4c398ff5-198f-47e1-8e13-cb70bee9ea8d",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "195bcb59-8186-4719-950b-7f043b05bcdd",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "ed95fba4-817d-4e96-8bc5-901c86a41093",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "f1ee8f88-3efa-49f0-ad0d-55f63da6707e",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "6ee62345-91af-4b4b-8e1c-bef6800fbd90",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "08dd1c46-cd70-4008-917a-0142dfef755e",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "80bfeb0d-947a-4c49-badb-82819d275938",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "205bce44-d156-4ddc-8568-86e16bb3335a",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "25a97dfc-84f6-4153-a236-564465e08e3e",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "d3c74e78-a833-4b69-afa2-a1746fafa5bf",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "6ebadd16-2b44-4b4e-a3e4-dbe0392b6865",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "165fdf60-7bd9-4aab-b893-9d91ec339a55",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "bd259b64-8a03-46ed-a5a0-319329eaab2e",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "45849335-c44c-4cf3-b114-64ca4f775015",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "121f3634-b246-4a1d-8d6a-70411763d90c",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "4bffc4d9-ab7f-4e54-ad8b-bbbead604dfc",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "2b35b23e-79fb-49d9-8d9c-4ea6c7efc968",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "081bddee-0cde-4c0a-87ea-9d54caaa0b2d"
    }
  ]
}