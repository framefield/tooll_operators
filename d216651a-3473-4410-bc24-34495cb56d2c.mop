{
  "Name": "CSVToList2",
  "_id": "d216651a-3473-4410-bc24-34495cb56d2c",
  "Namespace": "examples.barChart.helpers",
  "Description": "",
  "Inputs": [
    {
      "Name": "CSVText",
      "MetaInstanceID": "ea484c66-94bc-4896-91c4-3b49d73393fa",
      "DefaultValue": {
        "Type": "Text",
        "Value": ""
      },
      "MetaID": "c522a66e-3260-4692-b3e3-79fd0361fa3d",
      "IsMultiInput": "False",
      "Relevance": "Relevant",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Rows.First",
      "MetaInstanceID": "af52fba2-9fb2-43e2-aef4-b9a744cc5781",
      "DefaultValue": {
        "Type": "Float",
        "Value": "1"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "0",
      "Max": "10000",
      "Scale": "1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Rows.Count",
      "MetaInstanceID": "62e96087-8ea6-42a5-ad94-45f5cb6acc52",
      "DefaultValue": {
        "Type": "Float",
        "Value": "1"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "0",
      "Max": "10000",
      "Scale": "1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Columns.First",
      "MetaInstanceID": "23a2617d-791f-4598-9fe3-087f629773d6",
      "DefaultValue": {
        "Type": "Float",
        "Value": "1"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "0",
      "Max": "10000",
      "Scale": "1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "Columns.Count",
      "MetaInstanceID": "07a3ecb2-eae3-49ae-99b2-d31c3a5b6ab6",
      "DefaultValue": {
        "Type": "Float",
        "Value": "1"
      },
      "MetaID": "3f76dee3-3897-44ac-82d6-25ce9f53a506",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "0",
      "Max": "10000",
      "Scale": "1",
      "ScaleType": "Linear",
      "EnumValues": []
    },
    {
      "Name": "SplitCharacter",
      "MetaInstanceID": "2218b252-d64c-4d2b-8053-59479d486c39",
      "DefaultValue": {
        "Type": "Text",
        "Value": ""
      },
      "MetaID": "c522a66e-3260-4692-b3e3-79fd0361fa3d",
      "IsMultiInput": "False",
      "Relevance": "Optional",
      "Description": "",
      "Min": "-100000",
      "Max": "100000",
      "Scale": "0.1",
      "ScaleType": "Linear",
      "EnumValues": []
    }
  ],
  "Outputs": [
    {
      "Name": "Dynamic",
      "MetaInstanceID": "a855bc51-efaa-474a-8435-5ff1877d6a7a",
      "MetaID": "9701d534-b3ff-4889-a250-84aece4a7d76"
    }
  ],
  "OperatorParts": [
    {
      "MetaInstanceID": "2d37113c-8b81-41b3-8536-5ed69ab1c258",
      "MetaID": "16c25627-0858-4a69-abfe-085e2d9b2a62",
      "Name": "CSVToList2Func",
      "Version": "e8b57d4e-42f3-4b77-84bc-68c721a9241c",
      "Type": "Dynamic",
      "IsMultiInput": "True",
      "Script": [
        "//>>> _using",
        "using System;",
        "using System.Collections.Generic;",
        "using System.Linq;",
        "using System.Text;",
        "using SharpDX;",
        "using SharpDX.Direct3D11;",
        "using SharpDX.Windows;",
        "//<<< _using",
        "using System.Net;",
        "using System.IO;",
        "",
        "using System.Threading;",
        "using System.Threading.Tasks;",
        "using System.Collections.Specialized;",
        "",
        "namespace Framefield.Core.ID16c25627_0858_4a69_abfe_085e2d9b2a62",
        "{",
        "    public class Class_CSVToList2 : OperatorPart.Function",
        "    {",
        "        //>>> _inputids",
        "        private enum InputId",
        "        {",
        "            CSVText = 0,",
        "            RowsFirst = 1,",
        "            RowsCount = 2,",
        "            ColumnsFirst = 3,",
        "            ColumnsCount = 4,",
        "            SplitCharacter = 5",
        "        }",
        "        //<<< _inputids",
        "",
        "        List<List<string>> _tmpList = new List<List<string>>();",
        "        String _csvText;",
        "        List<String> _resultList = new List<String>();",
        "        ",
        "        int _rowsFirst;",
        "        int _rowsCount;",
        "        int _columnsFirst;",
        "        int _columnsCount;",
        "",
        "        public override OperatorPartContext Eval(OperatorPartContext context, List<OperatorPart> inputs, int outputIdx) {",
        "            //>>> _params",
        "            var CSVText = inputs[(int)InputId.CSVText].Eval(context).Text;",
        "            var RowsFirst = inputs[(int)InputId.RowsFirst].Eval(context).Value;",
        "            var RowsCount = inputs[(int)InputId.RowsCount].Eval(context).Value;",
        "            var Rows = new Vector2(RowsFirst, RowsCount);",
        "            var ColumnsFirst = inputs[(int)InputId.ColumnsFirst].Eval(context).Value;",
        "            var ColumnsCount = inputs[(int)InputId.ColumnsCount].Eval(context).Value;",
        "            var Columns = new Vector2(ColumnsFirst, ColumnsCount);",
        "            var SplitCharacter = inputs[(int)InputId.SplitCharacter].Eval(context).Text;",
        "            //<<< _params",
        "            ",
        "            if( _rowsFirst != (int)RowsFirst ",
        "                ||_rowsCount != (int)RowsCount",
        "                || _columnsFirst != (int)ColumnsFirst",
        "                || _columnsCount != (int)ColumnsCount",
        "            ) {",
        "                Changed = true;",
        "                _rowsFirst = (int)RowsFirst;",
        "                _rowsCount = (int)RowsCount;",
        "                _columnsFirst = (int)ColumnsFirst;",
        "                _columnsCount = (int)ColumnsCount;",
        "            }",
        "            ",
        "            if( Changed) {",
        "            ",
        "",
        "                if(SplitCharacter.Length != 1) {",
        "                    Logger.Warn(this,\"Invalid split-character : {0}\", SplitCharacter);",
        "                    _splitter = ',';",
        "                }",
        "                else {",
        "                    _splitter= SplitCharacter[0];",
        "                }",
        "            ",
        "            ",
        "                if( CSVText != _csvText) {            ",
        "                    _csvText = CSVText;",
        "                    _tmpList = SplitCSVLine( _csvText);",
        "                }                ",
        "                ",
        "                ",
        "                RowsCount = Math.Max( RowsCount, 1);",
        "                ColumnsCount = Math.Max( ColumnsCount, 1);",
        "                RowsFirst = Math.Max( RowsFirst, 0);",
        "                ColumnsFirst = Math.Max( ColumnsFirst, 1);",
        "                _resultList.Clear();",
        "                ",
        "                if(_tmpList.Count > 0) {",
        "                    for(int r = (int)RowsFirst; r < (int)RowsFirst + (int)RowsCount; ++r) {",
        "                        for(int c = (int)ColumnsFirst; c < (int)ColumnsFirst + (int)ColumnsCount; ++c) {",
        "                            if(_tmpList.Count > r && _tmpList[r].Count > c) {",
        "                                _resultList.Add( _tmpList[r][c]);",
        "                            }",
        "                        }",
        "                    }                ",
        "                }",
        "                Changed = false;",
        "            }",
        "            ",
        "            context.Dynamic = _resultList;",
        "            return context;",
        "        }",
        "        ",
        "        char _splitter= ',';",
        "        ",
        "        List<List<string>> SplitCSVLine(string lines)",
        "        {",
        "            var line = lines.Replace(\"<br>\\n\",\"\");",
        "            bool escapeActive = false;",
        "            bool quoteActive = false;",
        "            List<List<string>> result = new List<List<string>>();",
        "            var lineStrings = new List<string>();",
        "            string token = \"\";",
        "            foreach (char c in line)",
        "            {",
        "                if (c == '\\\\') {",
        "                    if (escapeActive) {",
        "                        token += c; ",
        "                    }",
        "                    else {",
        "                        escapeActive = true;",
        "                    }",
        "                } ",
        "                else if (c == '\"') {",
        "                    if (escapeActive) {",
        "                        token += c;",
        "                    } else if (quoteActive) {",
        "                        quoteActive = false;",
        "                    } else {",
        "                        quoteActive = true;",
        "                    }",
        "                } else if (c == _splitter) {",
        "                    if (quoteActive) {",
        "                        token += c;",
        "                    } else {",
        "                        lineStrings.Add(token);",
        "                        token = \"\";",
        "                    }",
        "                }",
        "                else if (c == '\\n') {",
        "                    if (quoteActive) {",
        "                        token += c;",
        "                    }",
        "                    else {",
        "                        lineStrings.Add(token);",
        "                        token = String.Empty;",
        "                        result.Add(lineStrings);",
        "                        lineStrings = new List<string>();",
        "                    }",
        "                }",
        "                else {",
        "                    token += c;",
        "                }",
        "            }",
        "            if (!String.IsNullOrEmpty(token)) {",
        "                lineStrings.Add(token);",
        "                result.Add(lineStrings);",
        "            }",
        "            return result;",
        "        }",
        "",
        "",
        "        Dictionary<string, int> KeysFromHeadline(List<string> headlineStrings) {",
        "            int id = 0;",
        "            Dictionary<string, int> result = new Dictionary<string, int>();",
        "            foreach (var s in headlineStrings) {",
        "                result[s] = id++;",
        "            }",
        "            return result;",
        "        }",
        "/*",
        "        public void UpdateWinnersFromCSV(string csv) {",
        "            return;",
        "            if(csv != _keepCategoriesCSV) {",
        "                InvalidData = false;",
        "                _keepCategoriesCSV = csv;",
        "                Logger.Info(this,\"Updateing winners from CSV\");",
        "",
        "                if (csv != \"\") {",
        "                    var lineStrings = SplitCSV(csv);",
        "                    var keyIds = KeysFromHeadline(lineStrings[0]);",
        "                    if (!keyIds.ContainsKey(\"CategoryID\") || !keyIds.ContainsKey(\"WinnerID\")) {",
        "                        Logger.Warn(this,\"Invalid category csv fileformat. CategoryID or WinnerID not found\");",
        "                        InvalidData = true;",
        "                    }",
        "                    else {",
        "",
        "                        Dictionary<string, string> categoryWinnerIds = new Dictionary<string, string>();",
        "",
        "                        for (int i = 1; i < lineStrings.Count; i++) {",
        "                            var ls = lineStrings[i];",
        "                            string catId = ls[keyIds[\"CategoryID\"]];",
        "                            string winnerId = ls[keyIds[\"WinnerID\"]];",
        "                            categoryWinnerIds[catId] = winnerId;",
        "                        }",
        "",
        "                        foreach (var c in CategoriesAndNominees) {",
        "                            if (categoryWinnerIds.ContainsKey(c.FileName)) {",
        "                                int id = 0;",
        "                                foreach (var n in c.Nominees) {",
        "                                    if (n.FileName == categoryWinnerIds[c.FileName]) {",
        "                                        break;",
        "                                    }",
        "                                    else {",
        "                                        id++; ",
        "                                    }",
        "                                }",
        "                                if (id < c.Nominees.Count) {",
        "                                    c.Winner = id;",
        "                                }",
        "                                else {",
        "                                    Logger.Warn(this,String.Format(\"WinnerID {0} not found in Category {1}\", categoryWinnerIds[c.FileName], c.FileName));",
        "                                    InvalidData = true;",
        "                                }",
        "                            }",
        "                        }",
        "                    }",
        "                }",
        "                Logger.Info(this,\"...completed\");",
        "            }",
        "        }",
        "        ",
        "        string _oldURL = \"\"; ",
        "        string _content =\"bla\";",
        "        float _lastUpdate = 0;",
        "        */",
        "    }",
        "    ",
        "}",
        "",
        ""
      ],
      "AdditionalAssemblies": []
    }
  ],
  "Operators": [],
  "Connections": [
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "2d37113c-8b81-41b3-8536-5ed69ab1c258",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "a855bc51-efaa-474a-8435-5ff1877d6a7a"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "ea484c66-94bc-4896-91c4-3b49d73393fa",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "2d37113c-8b81-41b3-8536-5ed69ab1c258"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "af52fba2-9fb2-43e2-aef4-b9a744cc5781",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "2d37113c-8b81-41b3-8536-5ed69ab1c258"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "62e96087-8ea6-42a5-ad94-45f5cb6acc52",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "2d37113c-8b81-41b3-8536-5ed69ab1c258"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "23a2617d-791f-4598-9fe3-087f629773d6",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "2d37113c-8b81-41b3-8536-5ed69ab1c258"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "07a3ecb2-eae3-49ae-99b2-d31c3a5b6ab6",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "2d37113c-8b81-41b3-8536-5ed69ab1c258"
    },
    {
      "SourceOp": "00000000-0000-0000-0000-000000000000",
      "SourceOpPart": "2218b252-d64c-4d2b-8053-59479d486c39",
      "TargetOp": "00000000-0000-0000-0000-000000000000",
      "TargetOpPart": "2d37113c-8b81-41b3-8536-5ed69ab1c258"
    }
  ]
}